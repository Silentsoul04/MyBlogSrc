---
title: 制作地图
layout: post
category: web
author: 夏泽民
---
<!-- more -->
参考：
https://bost.ocks.org/mike/map/
用 D3 和 TopoJSON做一个地图

1，安装转换工具
brew install gdal
npm install -g topojson@1
检查安装结果
which ogr2ogr
which topojson
2，获取数据
http://www.naturalearthdata.com/
国家：http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details/
省：http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-1-states-provinces/
城市：http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/
除了还有50m和110m数据
3，数据转换
参考：http://calmhawk.iteye.com/blog/2026798
ogr2ogr   -f GeoJSON   -where "ADM0_A3 IN ('CHN','HKG','MAC','TWN')"   subunits.json   ne_10m_admin_0_map_subunits/ne_10m_admin_0_map_subunits.shp
ogr2ogr   -f GeoJSON   -where "ISO_A2 = 'CN' AND SCALERANK < 8"   places.json   ne_10m_populated_places/ne_10m_populated_places.shp
ogr2ogr   -f GeoJSON   -where "ADM0_A3 = 'CHN'" cn_province.json ne_10m_admin_1_states_provinces/ne_10m_admin_1_states_provinces.shp
topojson   -o uk.json   --id-property SU_A3   --properties name=NAME   --   subunits.json   places.json cn_province.json

参考：
https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3
http://blog.csdn.net/zhou452840622/article/details/49058395
中国编号
CHN	 China  TWN	Taiwan, Province of China  
MAC	 Macao   HKG	Hong Kong
CHINA CN

4，视图转换，大小缩放
参考：https://en.wikipedia.org/wiki/Albers_projection
中国数据：
var projection = d3.geo.albers()  
    .scale(800)  
    .translate([width / 2, height / 2])  
    .rotate([-105, 0])  
    .center([0, 36])  
    .parallels([27, 45]); 
    
解释：
中间有一个关键的projection,投影.文中的albers projection中文名称叫等积圆锥投影,搜了一下参数,用如下code即可,简单原理就是

1. 先放大图形
2. 然后转换长宽到自己想要的大小
3. 然后旋转使自己的区域所在经度居中,以0°为基准,西经为正数,东经为负数,参数文中中国正中为105°:
4. 然后变换中心使自己的区域所在维度居中.
5. 标称维度,参数文中为27°和45°.
<img src="{{site.url}}{{site.baseurl}}/img/map_cn.png"/>
